<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Agricultural Robots Simulation Environment | Yixiao (Jimmy) Fang </title> <meta name="author" content="Yixiao (Jimmy) Fang"> <meta name="description" content="A simulation environment for under-canopy agricultural field robots"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://jimmyfyx.github.io/projects/1_project/"> <script src="/assets/js/theme.js?a81d82887dd692e91686b43de4542f18"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Yixiao</span> (Jimmy) Fang </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">ctrl k <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Agricultural Robots Simulation Environment</h1> <p class="post-description">A simulation environment for under-canopy agricultural field robots</p> </header> <article> <p>This project is related to our work <a href="https://arxiv.org/abs/2408.03059" rel="external nofollow noopener" target="_blank">Learning to Turn: Diffusion Imitation for Robust Row Turning in Under-Canopy Robots</a>, aiming to explore agricultural field robot policy learning with Sim2Real. Thus, an important piece of this work is to build a realistic simulation environment to collect simulated data, which is challenging due to the unstructureness of field environments.</p> <h2 id="procedure">Procedure</h2> <h3 id="isaacgym">IsaacGym</h3> <p>The initial idea was to use the recently developed simulator <a href="https://developer.nvidia.com/isaac-gym" rel="external nofollow noopener" target="_blank">IsaacGym</a> to build a customized simulation environment, as it has been widely used for robot policy learning. Moreover, we wanted to leverage its ability of runnning environments in parallel to accelerate data collection pipeline.</p> <p>In IsaacGym, we implemented the following features:</p> <ul> <li>Converted prepared models of crop variants (corn, tabacco, and soybean) and the field robot in SDF form to URDF form</li> <li>Developed a pipeline to generate 20 random croprow grid layouts for simulation at a time from a config file and load the assets into the simulator</li> <li>Configured RGB-D cameras to capture depth and image data</li> <li>Leveraged GPU acceleration to maintain a image rendering rate of 20 FPS across parallel environments</li> </ul> <p>However, experiments showed that the visual quality of rendered images from IsaacGym was not ideal for Sim2Real usage. Specifically, the lack of support for materials over object surfaces and poor rasterization effects limit the quality of RGB images, while the quality of depth images was decent.</p> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_agrisim_rgb-480.webp 480w,/assets/img/project_agrisim_rgb-800.webp 800w,/assets/img/project_agrisim_rgb-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/project_agrisim_rgb.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="RGB image in IsaacGym" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_agrisim_depth-480.webp 480w,/assets/img/project_agrisim_depth-800.webp 800w,/assets/img/project_agrisim_depth-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/project_agrisim_depth.png" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Depth image in IsaacGym" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> On the left, the RGB image is rendered from a timestep when the robot is moving. On the right, it's the corresponding depth image. </div> <p>The repo for the IsaacGym environment can be found at <a href="https://github.com/jimmyfyx/IsaacGym-uturn-Env" rel="external nofollow noopener" target="_blank">here</a>.</p> <h3 id="gazebo">Gazebo</h3> <p>We chose <a href="https://gazebosim.org/home" rel="external nofollow noopener" target="_blank">Gazebo</a> to be the solution to build our environments on. Although it provided rendered images with higher quality than IsaacGym, it limited the efficiency to collect massive amount of data without parallel environments. As a result, we developed an automatic data collection pipeline as well as some other features to migrate our design from IsaacGym:</p> <ul> <li>Refined the pipeline to generate random croprow layouts by adding customizations for crop orientations, heights, distance between crops â€¦</li> <li>Configured and added three RGB-D cameras to the robot agent in URDF format using camera sensor plugins provided by Gazebo</li> <li>Commanded the robot agent to follow defined trajectories using a MPC controller with ROS</li> <li>Automated the data collection pipeline by using the <code class="language-plaintext highlighter-rouge">subprocess</code> package in Python to terminate and restart the simulator and running Gazebo in headless mode</li> <li>Integrated the function to use a PS4 controller to control the robot agent with the <code class="language-plaintext highlighter-rouge">teleop_twist_joy</code> package in ROS</li> </ul> <div class="row"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" srcset="/assets/img/project_agrisim_gif-480.webp 480w,/assets/img/project_agrisim_gif-800.webp 800w,/assets/img/project_agrisim_gif-1400.webp 1400w," type="image/webp" sizes="95vw"></source> <img src="/assets/img/project_agrisim_gif.gif" class="img-fluid rounded z-depth-1" width="100%" height="auto" title="Gazebo simulation example" loading="eager" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> An example of how the robot agent completed one demonstration for row turning. </div> <p>The repo for the Gazebo environment can be found at <a href="https://github.com/jimmyfyx/terrasentia_gazebo" rel="external nofollow noopener" target="_blank">here</a>.</p> <h3 id="data-collection">Data Collection</h3> <p>Row-turning demonstration data can be collected either by commanding the robot to follow pre-defined trajectories or human teleoperation. In either way, data was recorded using ROS bags and extracted by ROS topic names. The following data was collected and synchronized:</p> <ul> <li>RGB images</li> <li>Depth images</li> <li>Goal position of each demonstration</li> <li>Trajectory of each demonstration (2D waypoints)</li> <li>Linear and angular velocities at each waypoint</li> </ul> <p>The data was then further processed using the <a href="https://zarr.readthedocs.io/en/stable/" rel="external nofollow noopener" target="_blank">Zarr</a> package. <code class="language-plaintext highlighter-rouge">.zarr</code> format files are similar to dictionaries with numpy arrays, but it can provide faster access to data during runtime by transferring them to RAM from disk space. In addition, data can be further compressed to save storage space. This will guarantee a significant speedup for model training time when loading data in <code class="language-plaintext highlighter-rouge">.zarr</code> format.</p> <h2 id="skills-used">Skills Used</h2> <ul> <li> <strong>Simulation</strong>: Gazebo, IsaacGym</li> <li> <strong>Programming</strong>: Python, C++, CUDA</li> <li> <strong>Robotics</strong>: ROS, MPC Controller, PID Controller, Differential drive dynamics</li> <li> <strong>Computer Vision and Graphics</strong>: Camera models, Image rendering and processing, rasterization</li> </ul> <h2 id="acknowledgement">Acknowledgement</h2> <p>Special thanks to <a href="https://www.arunnarenthiran.com/" rel="external nofollow noopener" target="_blank">Dr. Arun N. Sivakumar</a> and <a href="https://scholar.google.com/citations?user=9Yhzi4YAAAAJ&amp;hl=es" rel="external nofollow noopener" target="_blank">Jose Cuaran</a> for helping me through this project. Some assets used in simulation are credit to the <a href="http://daslab.illinois.edu/" rel="external nofollow noopener" target="_blank">DASLAB</a> at UIUC.</p> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> Â© Copyright 2025 Yixiao (Jimmy) Fang. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?c8a01c11a92744d44b093fc3bda915df" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>